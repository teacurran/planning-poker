apiVersion: v1
kind: ConfigMap
metadata:
  name: scrum-poker-config
  labels:
    app: scrum-poker-backend
    app.kubernetes.io/name: scrum-poker-backend
    app.kubernetes.io/component: backend
    app.kubernetes.io/part-of: scrum-poker-platform
data:
  # ==========================================
  # Database Configuration
  # ==========================================
  # NOTE: DB_USERNAME and DB_PASSWORD are in Secret, not here
  DB_JDBC_URL: "jdbc:postgresql://localhost:5432/scrumpoker"
  DB_REACTIVE_URL: "postgresql://localhost:5432/scrumpoker"
  DB_POOL_MAX_SIZE: "20"
  DB_POOL_IDLE_TIMEOUT: "PT10M"
  DB_LOG_SQL: "false"

  # ==========================================
  # Database Migrations (Flyway)
  # ==========================================
  FLYWAY_MIGRATE: "true"

  # ==========================================
  # Redis Configuration
  # ==========================================
  REDIS_URL: "redis://localhost:6379"
  REDIS_POOL_MAX_SIZE: "20"
  REDIS_POOL_MAX_WAITING: "50"
  REDIS_TIMEOUT: "10s"

  # ==========================================
  # JWT Configuration
  # ==========================================
  JWT_ISSUER: "https://scrumpoker.com"
  JWT_PUBLIC_KEY_LOCATION: "/publicKey.pem"
  # JWT_PRIVATE_KEY_LOCATION is in Secret
  JWT_TOKEN_EXPIRATION: "3600"
  JWT_REFRESH_TOKEN_EXPIRATION: "2592000"

  # ==========================================
  # OIDC Configuration
  # ==========================================
  OIDC_ENABLED: "false"
  # GOOGLE_CLIENT_ID and GOOGLE_CLIENT_SECRET in Secret
  # MICROSOFT_CLIENT_ID and MICROSOFT_CLIENT_SECRET in Secret

  # ==========================================
  # Enterprise SSO Configuration
  # ==========================================
  SSO_SAML2_SP_ENTITY_ID: "https://scrumpoker.com/saml2/metadata"
  SSO_SAML2_ACS_URL: "https://scrumpoker.com/api/v1/auth/sso/saml2/acs"
  SSO_SAML2_SLO_URL: "https://scrumpoker.com/api/v1/auth/sso/saml2/slo"
  SSO_SESSION_TIMEOUT: "28800"
  SSO_OIDC_TIMEOUT: "10000"
  SSO_SAML2_CLOCK_SKEW: "300"

  # ==========================================
  # Stripe Configuration
  # ==========================================
  # NOTE: STRIPE_API_KEY and STRIPE_WEBHOOK_SECRET are in Secret
  STRIPE_PRICE_PRO: "price_1234567890ProMonthly"
  STRIPE_PRICE_PRO_PLUS: "price_1234567890ProPlusMonthly"
  STRIPE_PRICE_ENTERPRISE: "price_1234567890EnterpriseMonthly"

  # ==========================================
  # AWS S3 Configuration
  # ==========================================
  S3_REGION: "us-east-1"
  # AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY in Secret
  S3_BUCKET_NAME: "scrum-poker-exports"
  EXPORT_URL_EXPIRATION: "604800"

  # ==========================================
  # WebSocket Configuration
  # ==========================================
  WS_MAX_FRAME_SIZE: "65536"

  # ==========================================
  # HTTP Configuration
  # ==========================================
  HTTP_PORT: "8080"
  HTTP_HOST: "0.0.0.0"
  CORS_ORIGINS: "http://localhost:3000,http://localhost:5173"
  CORS_METHODS: "GET,POST,PUT,DELETE,OPTIONS"
  CORS_HEADERS: "accept,authorization,content-type,x-requested-with"
  CORS_EXPOSED_HEADERS: "Content-Disposition"
  CORS_MAX_AGE: "24H"

  # ==========================================
  # Logging Configuration
  # ==========================================
  LOG_LEVEL: "INFO"
  LOG_JSON_FORMAT: "false"

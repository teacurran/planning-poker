# ==========================================
# Application Configuration
# ==========================================
quarkus.application.name=scrum-poker-backend

# ==========================================
# Database Configuration (PostgreSQL)
# ==========================================
# Database kind (applies to all profiles)
quarkus.datasource.db-kind=postgresql

# Connection pool settings (applies to all profiles)
quarkus.datasource.reactive.max-size=${DB_POOL_MAX_SIZE:20}
quarkus.datasource.reactive.idle-timeout=${DB_POOL_IDLE_TIMEOUT:PT10M}

# Production datasource configuration (will be overridden by environment variables in production)
%prod.quarkus.datasource.username=${DB_USERNAME:postgres}
%prod.quarkus.datasource.password=${DB_PASSWORD:postgres}
%prod.quarkus.datasource.jdbc.url=${DB_JDBC_URL:jdbc:postgresql://localhost:5432/scrumpoker}
%prod.quarkus.datasource.reactive.url=${DB_REACTIVE_URL:postgresql://localhost:5432/scrumpoker}

# Hibernate Reactive configuration
quarkus.hibernate-orm.database.generation=validate
quarkus.hibernate-orm.log.sql=${DB_LOG_SQL:false}
quarkus.hibernate-orm.log.bind-parameters=false

# ==========================================
# Database Migrations (Flyway)
# ==========================================
# Enabled after I1.T3 database migration scripts completion
# Set FLYWAY_MIGRATE=false environment variable to disable if needed
quarkus.flyway.migrate-at-start=${FLYWAY_MIGRATE:true}
quarkus.flyway.locations=classpath:db/migration
quarkus.flyway.baseline-on-migrate=true
quarkus.flyway.baseline-version=0

# ==========================================
# Redis Configuration
# ==========================================
# Redis connection (for prod and dev profiles - tests use Dev Services/Testcontainers)
%prod.quarkus.redis.hosts=${REDIS_URL:redis://localhost:6379}
%dev.quarkus.redis.hosts=${REDIS_URL:redis://localhost:6379}
quarkus.redis.client-type=standalone
quarkus.redis.max-pool-size=${REDIS_POOL_MAX_SIZE:20}
quarkus.redis.max-pool-waiting=${REDIS_POOL_MAX_WAITING:50}

# Redis timeout configuration
quarkus.redis.timeout=${REDIS_TIMEOUT:10s}

# Redis health check
quarkus.redis.health.enabled=true

# ==========================================
# JWT Configuration
# ==========================================
# JWT token issuer (must match issuer claim in generated tokens)
mp.jwt.verify.issuer=${JWT_ISSUER:https://scrumpoker.com}

# JWT token public key location (for signature verification)
# PRODUCTION NOTE: In production, set JWT_PUBLIC_KEY environment variable with actual key content
# instead of using file location. For development, the file location is used.
mp.jwt.verify.publickey.location=${JWT_PUBLIC_KEY_LOCATION:/publicKey.pem}

# JWT signing key location (for token generation - PRIVATE KEY)
# PRODUCTION NOTE: In production, this MUST be loaded from Kubernetes Secrets or secure vault
# via the JWT_PRIVATE_KEY environment variable containing the actual key content.
# NEVER commit privateKey.pem to version control (already in .gitignore).
smallrye.jwt.sign.key.location=${JWT_PRIVATE_KEY_LOCATION:/privateKey.pem}

# JWT access token expiration time in seconds (1 hour = 3600 seconds)
mp.jwt.token.expiration=${JWT_TOKEN_EXPIRATION:3600}

# Refresh token expiration in seconds (30 days = 2592000 seconds)
# Note: Refresh tokens are stored in Redis with this TTL, not in JWT itself
mp.jwt.refresh.token.expiration=${JWT_REFRESH_TOKEN_EXPIRATION:2592000}

# ==========================================
# OIDC Configuration (OAuth2/SSO)
# ==========================================
# Multi-tenant OIDC configuration for Google and Microsoft OAuth2 providers
# Uses environment variables for production credentials
# For local development, set these environment variables or use default dev values

# Global OIDC settings - keep disabled for now (REST controller will handle OAuth flow)
quarkus.oidc.enabled=${OIDC_ENABLED:false}

# ==========================================
# Google OAuth2 Provider Configuration
# ==========================================
# Google OAuth2 uses accounts.google.com as the authorization server
# JWKS endpoint: https://www.googleapis.com/oauth2/v3/certs
quarkus.oidc.google.auth-server-url=https://accounts.google.com
quarkus.oidc.google.client-id=${GOOGLE_CLIENT_ID:your-google-client-id}
quarkus.oidc.google.credentials.secret=${GOOGLE_CLIENT_SECRET:your-google-client-secret}
quarkus.oidc.google.application-type=web-app
quarkus.oidc.google.token.issuer=https://accounts.google.com
quarkus.oidc.google.token.audience=${GOOGLE_CLIENT_ID:your-google-client-id}

# ==========================================
# Microsoft OAuth2 Provider Configuration
# ==========================================
# Microsoft OAuth2 uses login.microsoftonline.com/common for multi-tenant apps
# Supports both personal Microsoft accounts and Azure AD organizational accounts
# JWKS endpoint: https://login.microsoftonline.com/common/discovery/v2.0/keys
quarkus.oidc.microsoft.auth-server-url=https://login.microsoftonline.com/common/v2.0
quarkus.oidc.microsoft.client-id=${MICROSOFT_CLIENT_ID:your-microsoft-client-id}
quarkus.oidc.microsoft.credentials.secret=${MICROSOFT_CLIENT_SECRET:your-microsoft-client-secret}
quarkus.oidc.microsoft.application-type=web-app
quarkus.oidc.microsoft.token.issuer=https://login.microsoftonline.com/common/v2.0
quarkus.oidc.microsoft.token.audience=${MICROSOFT_CLIENT_ID:your-microsoft-client-id}

# ==========================================
# Stripe Configuration (Billing & Subscriptions)
# ==========================================
# Stripe API Key (secret key for server-side API calls)
# PRODUCTION NOTE: Use test mode key (sk_test_...) for dev/staging
# Set STRIPE_API_KEY environment variable with live key (sk_live_...) in production
stripe.api-key=${STRIPE_API_KEY:sk_test_51234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789}

# Stripe Webhook Secret for signature verification
# Obtain from Stripe Dashboard → Developers → Webhooks → Signing secret
stripe.webhook-secret=${STRIPE_WEBHOOK_SECRET:whsec_test_1234567890abcdefghijklmnopqrstuvwxyz}

# Stripe Price IDs for subscription tiers
# Create prices in Stripe Dashboard → Products → Create price
# Each tier maps to a Stripe Price object with recurring billing
# Note: FREE tier has no Stripe price (no charge)
stripe.price.pro=${STRIPE_PRICE_PRO:price_1234567890ProMonthly}
stripe.price.pro-plus=${STRIPE_PRICE_PRO_PLUS:price_1234567890ProPlusMonthly}
stripe.price.enterprise=${STRIPE_PRICE_ENTERPRISE:price_1234567890EnterpriseMonthly}

# ==========================================
# WebSocket Configuration
# ==========================================
quarkus.websocket.dispatch-to-worker=false
quarkus.websocket.max-frame-size=${WS_MAX_FRAME_SIZE:65536}

# ==========================================
# HTTP Configuration
# ==========================================
quarkus.http.port=${HTTP_PORT:8080}
quarkus.http.host=${HTTP_HOST:0.0.0.0}
quarkus.http.non-application-root-path=/q

# CORS configuration
quarkus.http.cors=true
quarkus.http.cors.origins=${CORS_ORIGINS:http://localhost:3000,http://localhost:5173}
quarkus.http.cors.methods=${CORS_METHODS:GET,POST,PUT,DELETE,OPTIONS}
quarkus.http.cors.headers=${CORS_HEADERS:accept,authorization,content-type,x-requested-with}
quarkus.http.cors.exposed-headers=${CORS_EXPOSED_HEADERS:Content-Disposition}
quarkus.http.cors.access-control-max-age=${CORS_MAX_AGE:24H}

# ==========================================
# Health Checks
# ==========================================
quarkus.health.openapi.included=true

# ==========================================
# Metrics (Prometheus)
# ==========================================
quarkus.micrometer.enabled=true
quarkus.micrometer.export.prometheus.enabled=true
quarkus.micrometer.export.prometheus.path=/q/metrics

# ==========================================
# OpenAPI Documentation
# ==========================================
quarkus.smallrye-openapi.path=/q/openapi
quarkus.swagger-ui.always-include=true
quarkus.swagger-ui.path=/q/swagger-ui

# ==========================================
# Logging Configuration
# ==========================================
quarkus.log.level=${LOG_LEVEL:INFO}
quarkus.log.console.format=%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{3.}] (%t) %s%e%n
quarkus.log.console.json=${LOG_JSON_FORMAT:false}

# ==========================================
# Development Mode Configuration
# ==========================================
%dev.quarkus.log.level=DEBUG
%dev.quarkus.hibernate-orm.log.sql=true
%dev.quarkus.http.cors=true
%dev.quarkus.http.cors.origins=/.*/
# Temporarily disable Redis health check for dev mode (until Redis is set up)
%dev.quarkus.redis.health.enabled=false

# ==========================================
# Test Configuration
# ==========================================
# Test configuration moved to src/test/resources/application.properties
# Dev Services (Testcontainers) will automatically start PostgreSQL and Redis
# when no explicit datasource URLs are configured in the test profile

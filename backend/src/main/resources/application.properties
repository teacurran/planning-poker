# ==========================================
# Application Configuration
# ==========================================
quarkus.application.name=scrum-poker-backend

# ==========================================
# Database Configuration (PostgreSQL)
# ==========================================
# Database kind (applies to all profiles)
quarkus.datasource.db-kind=postgresql

# Connection pool settings (applies to all profiles)
quarkus.datasource.reactive.max-size=${DB_POOL_MAX_SIZE:20}
quarkus.datasource.reactive.idle-timeout=${DB_POOL_IDLE_TIMEOUT:PT10M}

# Production datasource configuration (will be overridden by environment variables in production)
%prod.quarkus.datasource.username=${DB_USERNAME:postgres}
%prod.quarkus.datasource.password=${DB_PASSWORD:postgres}
%prod.quarkus.datasource.jdbc.url=${DB_JDBC_URL:jdbc:postgresql://localhost:5432/scrumpoker}
%prod.quarkus.datasource.reactive.url=${DB_REACTIVE_URL:postgresql://localhost:5432/scrumpoker}

# Hibernate Reactive configuration
quarkus.hibernate-orm.database.generation=validate
quarkus.hibernate-orm.log.sql=${DB_LOG_SQL:false}
quarkus.hibernate-orm.log.bind-parameters=false

# ==========================================
# Database Migrations (Flyway)
# ==========================================
# Enabled after I1.T3 database migration scripts completion
# Set FLYWAY_MIGRATE=false environment variable to disable if needed
quarkus.flyway.migrate-at-start=${FLYWAY_MIGRATE:true}
quarkus.flyway.locations=classpath:db/migration
quarkus.flyway.baseline-on-migrate=true
quarkus.flyway.baseline-version=0

# ==========================================
# Redis Configuration
# ==========================================
# Redis connection
quarkus.redis.hosts=${REDIS_URL:redis://localhost:6379}
quarkus.redis.client-type=standalone
quarkus.redis.max-pool-size=${REDIS_POOL_MAX_SIZE:20}
quarkus.redis.max-pool-waiting=${REDIS_POOL_MAX_WAITING:50}

# Redis timeout configuration
quarkus.redis.timeout=${REDIS_TIMEOUT:10s}

# Redis health check
quarkus.redis.health.enabled=true

# ==========================================
# JWT Configuration
# ==========================================
# NOTE: JWT configuration is commented out to allow dev mode startup without key files
# Uncomment and configure when implementing authentication in later iterations
#
# JWT token issuer
# mp.jwt.verify.issuer=${JWT_ISSUER:https://scrumpoker.com}
#
# JWT token public key location (for verification)
# mp.jwt.verify.publickey.location=${JWT_PUBLIC_KEY_LOCATION:/publicKey.pem}
#
# JWT signing key location (for token generation)
# smallrye.jwt.sign.key.location=${JWT_PRIVATE_KEY_LOCATION:/privateKey.pem}
#
# JWT expiration times
# mp.jwt.token.expiration=${JWT_TOKEN_EXPIRATION:3600}
# mp.jwt.refresh.token.expiration=${JWT_REFRESH_TOKEN_EXPIRATION:86400}

# ==========================================
# OIDC Configuration (OAuth2/SSO)
# ==========================================
# OIDC Authentication - disabled by default for dev mode
# Will be configured properly when OAuth providers are set up
quarkus.oidc.enabled=${OIDC_ENABLED:false}
quarkus.oidc.auth-server-url=${OIDC_AUTH_SERVER_URL:https://accounts.google.com}
quarkus.oidc.client-id=${OIDC_CLIENT_ID:your-client-id}
quarkus.oidc.credentials.secret=${OIDC_CLIENT_SECRET:your-client-secret}
quarkus.oidc.application-type=web-app

# OIDC token configuration
quarkus.oidc.token.issuer=${OIDC_TOKEN_ISSUER:https://accounts.google.com}
quarkus.oidc.token.audience=${OIDC_TOKEN_AUDIENCE:your-client-id}

# ==========================================
# WebSocket Configuration
# ==========================================
quarkus.websocket.dispatch-to-worker=false
quarkus.websocket.max-frame-size=${WS_MAX_FRAME_SIZE:65536}

# ==========================================
# HTTP Configuration
# ==========================================
quarkus.http.port=${HTTP_PORT:8080}
quarkus.http.host=${HTTP_HOST:0.0.0.0}
quarkus.http.non-application-root-path=/q

# CORS configuration
quarkus.http.cors=true
quarkus.http.cors.origins=${CORS_ORIGINS:http://localhost:3000,http://localhost:5173}
quarkus.http.cors.methods=${CORS_METHODS:GET,POST,PUT,DELETE,OPTIONS}
quarkus.http.cors.headers=${CORS_HEADERS:accept,authorization,content-type,x-requested-with}
quarkus.http.cors.exposed-headers=${CORS_EXPOSED_HEADERS:Content-Disposition}
quarkus.http.cors.access-control-max-age=${CORS_MAX_AGE:24H}

# ==========================================
# Health Checks
# ==========================================
quarkus.health.openapi.included=true

# ==========================================
# Metrics (Prometheus)
# ==========================================
quarkus.micrometer.enabled=true
quarkus.micrometer.export.prometheus.enabled=true
quarkus.micrometer.export.prometheus.path=/q/metrics

# ==========================================
# OpenAPI Documentation
# ==========================================
quarkus.smallrye-openapi.path=/q/openapi
quarkus.swagger-ui.always-include=true
quarkus.swagger-ui.path=/q/swagger-ui

# ==========================================
# Logging Configuration
# ==========================================
quarkus.log.level=${LOG_LEVEL:INFO}
quarkus.log.console.format=%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{3.}] (%t) %s%e%n
quarkus.log.console.json=${LOG_JSON_FORMAT:false}

# ==========================================
# Development Mode Configuration
# ==========================================
%dev.quarkus.log.level=DEBUG
%dev.quarkus.hibernate-orm.log.sql=true
%dev.quarkus.http.cors=true
%dev.quarkus.http.cors.origins=/.*/

# ==========================================
# Test Configuration
# ==========================================
# Test configuration moved to src/test/resources/application.properties
# Dev Services (Testcontainers) will automatically start PostgreSQL and Redis
# when no explicit datasource URLs are configured in the test profile

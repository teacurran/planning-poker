# Test environment configuration for Quarkus tests

# ==========================================
# Datasource Configuration for Tests
# ==========================================
# IMPORTANT: Do NOT set explicit JDBC/reactive URLs here
# Dev Services (Testcontainers) will automatically configure datasources
# when no explicit URLs are provided
#
# The Maven Surefire plugin (in pom.xml) sets empty values for
# DB_JDBC_URL, DB_REACTIVE_URL, DB_USERNAME, and DB_PASSWORD
# environment variables, which allows Dev Services to activate

# ==========================================
# Security Configuration for Tests
# ==========================================
# Disable OIDC and security entirely for tests to prevent RequestScoped context issues
# The WebSocket client tests don't need security checks since the server uses permit-all
quarkus.oidc.enabled=false
quarkus.security.enabled=false
# Disable all security checks for integration tests (auth will be tested in Iteration 3)
quarkus.http.auth.permission.permit-all.paths=/*
quarkus.http.auth.permission.permit-all.policy=permit
quarkus.http.auth.policy.role-policy1.roles-allowed=**
# Disable proactive auth to prevent RequestScoped context issues
quarkus.http.auth.proactive=false

# ==========================================
# JWT Configuration for Tests
# ==========================================
# Configure MicroProfile JWT for token validation (used by SmallRye JWT parser)
mp.jwt.verify.issuer=https://scrumpoker.com
mp.jwt.verify.publickey.location=/publicKey.pem
mp.jwt.token.expiration=3600
mp.jwt.refresh.token.expiration=2592000

# ==========================================
# Database Migrations for Tests
# ==========================================
# Flyway migrations for tests
quarkus.flyway.migrate-at-start=true
quarkus.flyway.clean-at-start=false

# ==========================================
# Logging Configuration for Tests
# ==========================================
# Test logging
quarkus.log.level=INFO
quarkus.log.category."io.quarkus.datasource".level=DEBUG
quarkus.log.category."org.testcontainers".level=INFO
quarkus.log.category."io.quarkus.reactive.pg.client".level=DEBUG

# ==========================================
# Hibernate Configuration for Tests
# ==========================================
# Hibernate settings for tests
quarkus.hibernate-orm.log.sql=false
quarkus.hibernate-orm.database.generation=none

# ==========================================
# Redis Configuration for Tests
# ==========================================
# IMPORTANT: Do NOT set quarkus.redis.hosts here! Dev Services won't activate if it's set.
# The test profile must not have redis.hosts configured at all for Dev Services to work.
# Enable Dev Services for Redis (Testcontainers)
quarkus.redis.devservices.enabled=true
# Disable health check during tests (until Redis container is fully started)
quarkus.redis.health.enabled=false

# ==========================================
# WebSocket Configuration for Tests
# ==========================================
# Run WebSocket handlers on Vert.x event loop to enable reactive operations
quarkus.websockets.run-on-virtual-thread=false

# ==========================================
# Stripe Configuration for Tests
# ==========================================
# Test webhook secret for signature verification in integration tests
stripe.webhook-secret=whsec_test_1234567890abcdefghijklmnopqrstuvwxyz
# Test API key (not used in webhook tests but required by config)
stripe.api-key=sk_test_51234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789
